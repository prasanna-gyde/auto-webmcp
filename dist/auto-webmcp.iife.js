"use strict";var AutoWebMCP=(()=>{var g=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var J=Object.prototype.hasOwnProperty;var _=(e,t)=>()=>(e&&(t=e(e=0)),t);var x=(e,t)=>{for(var n in t)g(e,n,{get:t[n],enumerable:!0})},q=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of j(t))!J.call(e,o)&&o!==n&&g(e,o,{get:()=>t[o],enumerable:!(r=O(t,o))||r.enumerable});return e};var D=e=>q(g({},"__esModule",{value:!0}),e);var F={};x(F,{getAllRegisteredTools:()=>y,getRegisteredToolName:()=>te,isWebMCPSupported:()=>u,registerFormTool:()=>h,unregisterAll:()=>E,unregisterFormTool:()=>m});function u(){return typeof navigator<"u"&&typeof navigator.modelContext<"u"}async function h(e,t,n){if(!u())return;c.get(e)&&await m(e),await navigator.modelContext.registerTool({name:t.name,description:t.description,inputSchema:t.inputSchema,execute:n}),c.set(e,t.name)}async function m(e){if(!u())return;let t=c.get(e);if(t){try{await navigator.modelContext.unregisterTool(t)}catch{}c.delete(e)}}function te(e){return c.get(e)}function y(){return Array.from(c.entries()).map(([e,t])=>({form:e,name:t}))}async function E(){let e=Array.from(c.entries());await Promise.all(e.map(([t])=>m(t)))}var c,f=_(()=>{"use strict";c=new Map});var ge={};x(ge,{autoWebMCP:()=>W});function M(e){return{exclude:e?.exclude??[],autoSubmit:e?.autoSubmit??!1,enhance:e?.enhance??null,overrides:e?.overrides??{},debug:e?.debug??!1}}function L(e){return e instanceof HTMLInputElement?B(e):e instanceof HTMLTextAreaElement?{type:"string"}:e instanceof HTMLSelectElement?z(e):null}function B(e){switch(e.type.toLowerCase()){case"text":case"search":case"tel":return b(e);case"email":return{...b(e),format:"email"};case"url":return{...b(e),format:"uri"};case"number":case"range":{let n={type:"number"};return e.min!==""&&(n.minimum=parseFloat(e.min)),e.max!==""&&(n.maximum=parseFloat(e.max)),n}case"date":return{type:"string",format:"date"};case"datetime-local":return{type:"string",format:"date-time"};case"time":return{type:"string",format:"time"};case"month":return{type:"string",pattern:"^\\d{4}-\\d{2}$"};case"week":return{type:"string",pattern:"^\\d{4}-W\\d{2}$"};case"color":return{type:"string",pattern:"^#[0-9a-fA-F]{6}$"};case"checkbox":return{type:"boolean"};case"radio":return{type:"string"};case"file":case"hidden":case"submit":case"reset":case"button":case"image":return null;case"password":return null;default:return{type:"string"}}}function b(e){let t={type:"string"};return e.minLength>0&&(t.minLength=e.minLength),e.maxLength>0&&e.maxLength!==524288&&(t.maxLength=e.maxLength),e.pattern&&(t.pattern=e.pattern),t}function z(e){let t=Array.from(e.options).filter(n=>n.value!=="").map(n=>n.value);return t.length===0?{type:"string"}:{type:"string",enum:t}}function w(e,t){return Array.from(e.querySelectorAll(`input[type="radio"][name="${CSS.escape(t)}"]`)).map(r=>r.value).filter(r=>r!=="")}var U=0;function C(e,t){let n=t?.name??G(e),r=t?.description??Z(e),o=Q(e);return{name:n,description:r,inputSchema:o}}function G(e){let t=e.dataset.webmcpName;if(t)return l(t);let n=K(e);if(n)return l(n);let r=A(e);if(r)return l(r);if(e.id)return l(e.id);if(e.name)return l(e.name);if(e.action){let o=Y(e.action);if(o)return l(o)}return`form_${++U}`}function l(e){return e.toLowerCase().trim().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"").slice(0,64)||"form"}function K(e){let t=[...Array.from(e.querySelectorAll('button[type="submit"], button:not([type])')),...Array.from(e.querySelectorAll('input[type="submit"]'))];for(let n of t){let r=n instanceof HTMLInputElement?n.value.trim():n.textContent?.trim()??"";if(r&&r.length>0&&r.length<80)return r}return""}function A(e){let t=e;for(;t;){let n=t.previousElementSibling;for(;n;){if(/^H[1-3]$/i.test(n.tagName)){let r=n.textContent?.trim()??"";if(r)return r}n=n.previousElementSibling}if(t=t.parentElement,!t||t===document.body)break}return""}function Y(e){try{let n=new URL(e,window.location.href).pathname.split("/").filter(Boolean);return n[n.length-1]??""}catch{return""}}function Z(e){let t=e.dataset.webmcpDescription;if(t)return t.trim();let n=e.querySelector("legend");if(n?.textContent?.trim())return n.textContent.trim();let r=e.getAttribute("aria-label");if(r?.trim())return r.trim();let o=e.getAttribute("aria-describedby");if(o){let s=document.getElementById(o);if(s?.textContent?.trim())return s.textContent.trim()}let i=A(e),a=document.title?.trim();return i&&a?`${i} \u2014 ${a}`:i||a||"Submit form"}function Q(e){let t={},n=[],r=new Set,o=Array.from(e.querySelectorAll("input, textarea, select"));for(let i of o){let a=i.name;if(!a)continue;if(i instanceof HTMLInputElement&&i.type==="radio"){if(r.has(a))continue;r.add(a)}let s=L(i);if(!s)continue;s.title=V(i);let v=X(i);v&&(s.description=v),i instanceof HTMLInputElement&&i.type==="radio"&&(s.enum=w(e,a)),t[a]=s,i.required&&n.push(a)}return{type:"object",properties:t,required:n}}function V(e){if("dataset"in e&&e.dataset.webmcpTitle)return e.dataset.webmcpTitle;let t=ee(e);return t||(e.name?H(e.name):e.id?H(e.id):"")}function X(e){let t=e;if(t.dataset.webmcpDescription)return t.dataset.webmcpDescription;let n=e.getAttribute("aria-description");if(n)return n;let r=e.getAttribute("aria-describedby");if(r){let o=document.getElementById(r);if(o?.textContent?.trim())return o.textContent.trim()}if(e instanceof HTMLInputElement||e instanceof HTMLTextAreaElement){let o=e.placeholder?.trim();if(o&&o.length>0)return o}return""}function ee(e){if(e.id){let n=document.querySelector(`label[for="${CSS.escape(e.id)}"]`);if(n){let r=S(n);if(r)return r}}let t=e.closest("label");if(t){let n=S(t);if(n)return n}return""}function S(e){let t=e.cloneNode(!0);return t.querySelectorAll("input, select, textarea, button").forEach(n=>n.remove()),t.textContent?.trim()??""}function H(e){return e.replace(/[-_]/g," ").replace(/([a-z])([A-Z])/g,"$1 $2").trim().replace(/\b\w/g,t=>t.toUpperCase())}f();var T=new WeakMap;function P(e,t){return ne(e),async n=>(re(e,n),new Promise((r,o)=>{T.set(e,{resolve:r,reject:o}),(t.autoSubmit||e.dataset.webmcpAutosubmit!==void 0)&&e.requestSubmit()}))}function ne(e){e.__awmcp_intercepted||(e.__awmcp_intercepted=!0,e.addEventListener("submit",t=>{let n=T.get(e);if(!n)return;let{resolve:r}=n;T.delete(e);let o=ie(e);if(t.agentInvoked&&typeof t.respondWith=="function")t.preventDefault(),t.respondWith(Promise.resolve({success:!0,data:o})),r({success:!0,data:o});else{let i=ae(e);r({success:!0,data:o,url:i})}}))}function re(e,t){for(let[n,r]of Object.entries(t)){let o=CSS.escape(n),i=e.querySelector(`[name="${o}"]`);i&&(i instanceof HTMLInputElement?oe(i,e,n,r):i instanceof HTMLTextAreaElement?(i.value=String(r??""),i.dispatchEvent(new Event("input",{bubbles:!0})),i.dispatchEvent(new Event("change",{bubbles:!0}))):i instanceof HTMLSelectElement&&(i.value=String(r??""),i.dispatchEvent(new Event("change",{bubbles:!0}))))}}function oe(e,t,n,r){let o=e.type.toLowerCase();if(o==="checkbox"){e.checked=!!r,e.dispatchEvent(new Event("change",{bubbles:!0}));return}if(o==="radio"){let i=CSS.escape(n),a=t.querySelectorAll(`input[type="radio"][name="${i}"]`);for(let s of a)if(s.value===String(r)){s.checked=!0,s.dispatchEvent(new Event("change",{bubbles:!0}));break}return}e.value=String(r??""),e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0}))}function ie(e){let t={},n=new FormData(e);for(let[r,o]of n.entries())if(t[r]!==void 0){let i=t[r];Array.isArray(i)?i.push(o):t[r]=[i,o]}else t[r]=o;return t}function ae(e){if(e.action)try{return new URL(e.action,window.location.href).href}catch{}return window.location.href}async function R(e,t){try{let n=await se(e,t);return{...e,description:n}}catch(n){return console.warn("[auto-webmcp] Enrichment failed, using heuristic description:",n),e}}async function se(e,t){let n=ce(e);return t.provider==="claude"?le(n,t):ue(n,t)}function ce(e){let t=Object.entries(e.inputSchema.properties).map(([n,r])=>`- ${r.title??n} (${r.type}): ${r.description??""}`).join(`
`);return`You are helping describe a web form as an AI tool. Given this form information:

Name: ${e.name}
Current description: ${e.description}
Fields:
${t}

Write a concise (1-2 sentence) description of what this tool does and when an AI agent should use it. Be specific and actionable. Respond with only the description, no preamble.`}async function le(e,t){let n=t.model??"claude-haiku-4-5-20251001",r=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"x-api-key":t.apiKey,"anthropic-version":"2023-06-01","content-type":"application/json"},body:JSON.stringify({model:n,max_tokens:150,messages:[{role:"user",content:e}]})});if(!r.ok)throw new Error(`Claude API error: ${r.status}`);return(await r.json()).content.filter(i=>i.type==="text").map(i=>i.text).join("").trim()}async function ue(e,t){let r=`https://generativelanguage.googleapis.com/v1beta/models/${t.model??"gemini-1.5-flash"}:generateContent?key=${t.apiKey}`,o=await fetch(r,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:e}]}],generationConfig:{maxOutputTokens:150,temperature:.2}})});if(!o.ok)throw new Error(`Gemini API error: ${o.status}`);return(await o.json()).candidates[0]?.content.parts.map(a=>a.text).join("").trim()??""}function k(e,t,n){window.dispatchEvent(new CustomEvent(e,{detail:{form:t,toolName:n}}))}function me(e,t){if(e.hasAttribute("toolname")||e.dataset.noWebmcp!==void 0)return!0;for(let n of t.exclude)try{if(e.matches(n))return!0}catch{}return!1}async function I(e,t){if(me(e,t))return;let n;for(let[i,a]of Object.entries(t.overrides))try{if(e.matches(i)){n=a;break}}catch{}let r=C(e,n);t.enhance&&(t.debug&&console.debug(`[auto-webmcp] Enriching: ${r.name}\u2026`),r=await R(r,t.enhance));let o=P(e,t);await h(e,r,o),t.debug&&console.debug(`[auto-webmcp] Registered: ${r.name}`,r),k("form:registered",e,r.name)}async function de(e,t){let{getRegisteredToolName:n}=await Promise.resolve().then(()=>(f(),F)),r=n(e);r&&(await m(e),t.debug&&console.debug(`[auto-webmcp] Unregistered: ${r}`),k("form:unregistered",e,r))}var p=null;function pe(e){p||(p=new MutationObserver(t=>{for(let n of t){for(let r of n.addedNodes){if(!(r instanceof Element))continue;let o=r instanceof HTMLFormElement?[r]:Array.from(r.querySelectorAll("form"));for(let i of o)I(i,e)}for(let r of n.removedNodes){if(!(r instanceof Element))continue;let o=r instanceof HTMLFormElement?[r]:Array.from(r.querySelectorAll("form"));for(let i of o)de(i,e)}}}),p.observe(document.body,{childList:!0,subtree:!0}))}function fe(e){window.addEventListener("hashchange",()=>d(e));let t={pushState:history.pushState.bind(history),replaceState:history.replaceState.bind(history)};history.pushState=function(...n){t.pushState(...n),d(e)},history.replaceState=function(...n){t.replaceState(...n),d(e)},window.addEventListener("popstate",()=>d(e))}async function d(e){let t=Array.from(document.querySelectorAll("form"));await Promise.all(t.map(n=>I(n,e)))}async function $(e){document.readyState==="loading"&&await new Promise(t=>document.addEventListener("DOMContentLoaded",()=>t(),{once:!0})),await d(e),pe(e),fe(e)}function N(){p?.disconnect(),p=null}f();async function W(e){let t=M(e);return t.debug&&console.debug("[auto-webmcp] Initializing",{webmcpSupported:u(),config:t}),await $(t),{destroy:async()=>{N(),await E()},getTools:y,isSupported:u()}}typeof window<"u"&&!window.__AUTO_WEBMCP_NO_AUTOINIT&&W();return D(ge);})();
//# sourceMappingURL=auto-webmcp.iife.js.map
